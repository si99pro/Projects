"use strict";(self.webpackChunkmemories=self.webpackChunkmemories||[]).push([[915],{4915:(e,t,i)=>{i.r(t),i.d(t,{default:()=>L});var n=i(5043),a=i(791),r=i(5472),o=i(3182),s=i(9900),l=i(4799),c=i(3849),d=i(3969),x=i(298),p=i(267),m=i(9806),h=i(172),u=i(5895),f=i(6803),g=i(2097),y=i(3023),A=i(1911),j=i(8776),b=i(9200),k=i(5877),v=i(3546),C=i(3605),w=i(9826),S=i(7873),z=i(3759),E=i(8065),P=i(2579),I=i(853),D=i(8746),M=i(7175),N=i(687),W=i(894),T=i(579);const R=n.memo((e=>{var t;let{notification:i,isAdmin:n,onMarkReadToggle:a,onNotificationClick:r,onDeleteRequest:o}=e;const s=(0,p.A)(),c=null!==(t=i.timestamp)&&void 0!==t&&t.toDate()?(0,I.m)(i.timestamp.toDate(),{addSuffix:!0}):"Just now",x=i.senderName||"System Update",m=i.senderStudentId?`${x} (${i.senderStudentId})`:x,h=(null===x||void 0===x?void 0:x.charAt(0).toUpperCase())||"S",f=!i.read,g=f?(0,w.X4)(s.palette.primary.main,.07):s.palette.background.paper,y=f?(0,w.X4)(s.palette.primary.main,.12):(0,w.X4)(s.palette.action.hover,.04),A=f||i.link;return(0,T.jsx)(C.P.div,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,x:-30,transition:{duration:.25}},transition:{type:"spring",stiffness:260,damping:25},children:(0,T.jsxs)(l.A,{variant:"outlined",sx:{p:1.75,mb:1.5,display:"flex",gap:2,alignItems:"flex-start",backgroundColor:g,borderLeft:`3px solid ${f?s.palette.primary.main:"transparent"}`,transition:s.transitions.create(["background-color","box-shadow","border-left-color"],{duration:s.transitions.duration.short}),cursor:A?"pointer":"default","&:hover":{boxShadow:s.shadows[3],backgroundColor:y}},onClick:e=>{A&&r(i)},children:[(0,T.jsx)(S.A,{sx:{bgcolor:f?"primary.main":"grey.500",width:40,height:40,mt:.25,fontSize:"1.1rem",transition:"background-color 0.3s ease"},children:h}),(0,T.jsxs)(d.A,{sx:{flexGrow:1,display:"flex",flexDirection:"column",pt:.25},children:[(0,T.jsx)(u.A,{variant:"body1",sx:{fontWeight:f?600:400,mb:.5,lineHeight:1.4,pointerEvents:"none"},children:i.title||"Notification"}),(0,T.jsx)(u.A,{variant:"body2",color:"text.secondary",sx:{mb:1,pointerEvents:"none",lineHeight:1.5},children:i.message||""}),(0,T.jsxs)(d.A,{sx:{display:"flex",alignItems:"center",gap:1.5,flexWrap:"wrap"},children:[(0,T.jsxs)(d.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,T.jsxs)(u.A,{variant:"caption",color:"text.secondary",sx:{pointerEvents:"none"},children:["From: ",m]}),(0,T.jsxs)(u.A,{variant:"caption",color:f?"primary.dark":"text.disabled",sx:{pointerEvents:"none",fontWeight:f?500:400},children:["\u2022 ",c]})]}),i.category&&(0,T.jsx)(z.A,{size:"small",label:i.category,sx:{height:"20px",fontSize:"0.7rem",pointerEvents:"none",bgcolor:(0,w.X4)(s.palette.secondary.main,.1),color:"secondary.dark",fontWeight:500}})]})]}),(0,T.jsxs)(d.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:.5,ml:"auto",pt:.5},children:[i.link&&(0,T.jsx)(E.A,{title:"Open Link",placement:"left",children:(0,T.jsx)(P.A,{size:"small",onClick:e=>{e.stopPropagation(),r(i)},"aria-label":"Open link",sx:{color:"primary.main","&:hover":{bgcolor:(0,w.X4)(s.palette.primary.main,.1)}},children:(0,T.jsx)(W.A,{sx:{fontSize:"1.1rem"}})})}),(0,T.jsx)(E.A,{title:f?"Mark as Read":"Mark as Unread",placement:"left",children:(0,T.jsx)(P.A,{size:"small",onClick:e=>{e.stopPropagation(),a(i.id,i.read)},"aria-label":f?"Mark as read":"Mark as unread",sx:{color:f?"primary.main":"text.secondary","&:hover":{bgcolor:(0,w.X4)(f?s.palette.primary.main:s.palette.action.active,.1)}},children:f?(0,T.jsx)(N.A,{sx:{fontSize:"1.1rem"}}):(0,T.jsx)(M.A,{sx:{fontSize:"1.1rem"}})})}),n&&(0,T.jsx)(E.A,{title:"Delete Notification",placement:"left",children:(0,T.jsx)(P.A,{size:"small",onClick:e=>{e.stopPropagation(),o(i.id)},color:"error","aria-label":"Delete notification",sx:{"&:hover":{bgcolor:(0,w.X4)(s.palette.error.main,.15)}},children:(0,T.jsx)(D.A,{sx:{fontSize:"1.1rem"}})})})]})]})})}));var X=i(3383),B=i(9891);const G=()=>(0,T.jsxs)(l.A,{variant:"outlined",sx:{p:1.75,mb:1.5,display:"flex",gap:2,alignItems:"center"},children:[(0,T.jsx)(c.A,{variant:"circular",width:40,height:40,sx:{mt:.25}}),(0,T.jsxs)(d.A,{sx:{flexGrow:1,pt:.25},children:[(0,T.jsx)(c.A,{variant:"text",width:"85%",sx:{mb:.75,height:"1.4rem"}}),(0,T.jsx)(c.A,{variant:"text",width:"65%",sx:{mb:1.25,height:"1rem"}}),(0,T.jsx)(c.A,{variant:"text",width:"40%",sx:{height:"0.8rem"}})]}),(0,T.jsxs)(x.A,{direction:"column",spacing:1,sx:{ml:"auto",pt:.5},children:[(0,T.jsx)(c.A,{variant:"circular",width:28,height:28}),(0,T.jsx)(c.A,{variant:"circular",width:28,height:28})]})]});const L=function(){const{user:e,isAdmin:t,authLoading:i}=(0,o.As)(),l=null===e||void 0===e?void 0:e.uid,c=(0,s.Zp)(),w=(0,p.A)(),[S,z]=(0,n.useState)([]),[E,P]=(0,n.useState)(!0),[I,D]=(0,n.useState)(!1),[M,N]=(0,n.useState)(null),[W,L]=(0,n.useState)(!0),[F,H]=(0,n.useState)(null),[$,U]=(0,n.useState)(!1),[q,J]=(0,n.useState)(null),O=(0,n.useCallback)((async()=>{if(i)P(!0);else{if(!l)return P(!1),z([]),void L(!1);P(!0),H(null),N(null),L(!0),z([]);try{const e=(0,r.rJ)(a.db,"users",l,"notifications"),t=(0,r.P)(e,(0,r.My)("timestamp","desc"),(0,r.AB)(10)),i=await(0,r.GG)(t),n=i.docs.map((e=>({id:e.id,...e.data()})));z(n),N(i.docs[i.docs.length-1]||null),L(10===n.length)}catch(e){console.error("Error fetching initial notifications:",e),H("Failed to load notifications. Please try again later."),z([]),L(!1)}finally{P(!1)}}}),[l,i]),Y=(0,n.useCallback)((async()=>{if(l&&!I&&W&&M){D(!0),H(null);try{const e=(0,r.rJ)(a.db,"users",l,"notifications"),t=(0,r.P)(e,(0,r.My)("timestamp","desc"),(0,r.HM)(M),(0,r.AB)(10)),i=await(0,r.GG)(t),n=i.docs.map((e=>({id:e.id,...e.data()})));z((e=>[...e,...n])),N(i.docs[i.docs.length-1]||null),L(10===n.length)}catch(e){console.error("Error fetching more notifications:",e),H("Failed to load more notifications.")}finally{D(!1)}}}),[l,I,W,M]);(0,n.useEffect)((()=>{O()}),[O]);const Z=(0,n.useCallback)((async(e,t)=>{if(!l||!e)return;const i=(0,r.H9)(a.db,"users",l,"notifications",e),n=!t;z((t=>t.map((t=>t.id===e?{...t,read:n}:t))));try{await(0,r.BN)(i,{read:n,readTimestamp:n?(0,r.O5)():null},{merge:!0})}catch(F){console.error("Error updating notification read state:",F),H("Couldn't update notification status. Please try again."),z((i=>i.map((i=>i.id===e?{...i,read:t}:i))))}}),[l]),_=(0,n.useCallback)((e=>{if(e.read||Z(e.id,!1),e.link&&"string"===typeof e.link&&""!==e.link.trim())try{e.link.startsWith("http")?window.open(e.link,"_blank","noopener,noreferrer"):e.link.startsWith("/")?c(e.link):console.warn("Unsupported link format:",e.link)}catch(t){console.error("Error navigating/opening link:",e.link,t),H("Could not open the requested link.")}}),[c,Z]),K=(0,n.useCallback)((e=>{J(e),U(!0)}),[]),Q=(0,n.useCallback)((()=>{U(!1),setTimeout((()=>J(null)),300)}),[]),V=(0,n.useCallback)((async()=>{if(!l||!q||!t)return console.error("Delete prevented: Invalid state."),H("Could not delete notification due to an internal error."),void Q();const e=q;U(!1);const i=S;z((t=>t.filter((t=>t.id!==e)))),J(null);const n=(0,r.H9)(a.db,"users",l,"notifications",e);try{await(0,r.kd)(n)}catch(F){console.error("Error deleting notification:",F),H("Failed to delete the notification. Please try again."),z(i)}}),[l,t,q,S,Q]);return i?(0,T.jsxs)(m.A,{maxWidth:"md",sx:{py:4,textAlign:"center"},children:[(0,T.jsx)(h.A,{}),(0,T.jsx)(u.A,{sx:{mt:2},children:"Loading user data..."})]}):l?(0,T.jsxs)(m.A,{maxWidth:"md",sx:{py:{xs:3,sm:4}},children:[(0,T.jsx)(u.A,{variant:"h4",component:"h1",sx:{mb:{xs:2,sm:3},fontWeight:700,color:"text.primary"},children:"Notifications"}),(0,T.jsx)(v.N,{children:F&&(0,T.jsx)(C.P.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20,transition:{duration:.2}},style:{position:"sticky",top:w.spacing(1.5),zIndex:w.zIndex.appBar+1,marginBottom:w.spacing(2)},children:(0,T.jsx)(f.A,{severity:"error",onClose:()=>H(null),variant:"filled",sx:{width:"100%"},children:F})})}),E?(0,T.jsx)(x.A,{spacing:0,sx:{mt:2},children:[...Array(5)].map(((e,t)=>(0,T.jsx)(G,{},`skeleton-${t}`)))}):0===S.length?(0,T.jsxs)(d.A,{sx:{textAlign:"center",mt:{xs:6,sm:10},color:"text.secondary"},children:[(0,T.jsx)(X.A,{sx:{fontSize:"5rem",mb:2,color:w.palette.grey[400]}}),(0,T.jsx)(u.A,{variant:"h6",component:"p",sx:{mb:1,fontWeight:500},children:"All caught up!"}),(0,T.jsx)(u.A,{children:"You have no notifications right now."})]}):(0,T.jsxs)(d.A,{sx:{mt:2},children:[(0,T.jsx)(v.N,{initial:!1,children:(0,T.jsxs)(x.A,{spacing:0,children:[" ",S.map((e=>(0,T.jsx)(R,{notification:e,isAdmin:t,onMarkReadToggle:Z,onNotificationClick:_,onDeleteRequest:K},e.id)))]})}),W&&(0,T.jsx)(d.A,{sx:{textAlign:"center",my:4},children:(0,T.jsx)(g.A,{variant:"outlined",color:"primary",onClick:Y,disabled:I,startIcon:I?(0,T.jsx)(h.A,{size:20,color:"inherit"}):null,sx:{textTransform:"none",borderRadius:"20px",px:3},children:I?"Loading More...":"Load More Notifications"})}),!W&&S.length>0&&!I&&(0,T.jsx)(u.A,{variant:"caption",display:"block",textAlign:"center",color:"text.disabled",sx:{my:4},children:"End of notifications."})]}),(0,T.jsxs)(y.A,{open:$,onClose:Q,"aria-labelledby":"delete-confirm-title",PaperProps:{sx:{borderRadius:2}},children:[(0,T.jsxs)(A.A,{id:"delete-confirm-title",sx:{display:"flex",alignItems:"center",borderBottom:`1px solid ${w.palette.divider}`,pb:1.5},children:[(0,T.jsx)(B.A,{sx:{mr:1.5,color:"error.main"}}),"Confirm Deletion"]}),(0,T.jsx)(j.A,{sx:{pt:"20px !important"},children:(0,T.jsx)(b.A,{children:"Are you sure you want to permanently delete this notification? This action cannot be undone."})}),(0,T.jsxs)(k.A,{sx:{p:2},children:[(0,T.jsx)(g.A,{onClick:Q,sx:{textTransform:"none",color:"text.secondary"},children:"Cancel"}),(0,T.jsx)(g.A,{onClick:V,color:"error",variant:"contained",disableElevation:!0,sx:{textTransform:"none"},autoFocus:!0,children:"Delete Notification"})]})]})]}):(0,T.jsx)(m.A,{maxWidth:"md",sx:{py:4,textAlign:"center"},children:(0,T.jsx)(f.A,{severity:"warning",variant:"outlined",children:"Please log in to view your notifications."})})}}}]);
//# sourceMappingURL=915.7aaf68dd.chunk.js.map