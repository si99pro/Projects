"use strict";(self.webpackChunkmemories=self.webpackChunkmemories||[]).push([[346],{6346:(e,t,i)=>{i.r(t),i.d(t,{default:()=>C});var r=i(5043),n=i(3969),s=i(3849),o=i(298),a=i(405),l=i(7873),c=i(5895),d=i(2579),x=i(6803),h=i(6178),m=i.n(h),u=i(5939),A=i(4603),f=i(3724),p=i(5837),j=i(791),w=i(5472),g=i(579);function v(e){let t,i=0;for(t=0;t<e.length;t+=1)i=e.charCodeAt(t)+((i<<5)-i);let r="#";for(t=0;t<3;t+=1){r+=`00${(i>>8*t&255).toString(16)}`.slice(-2)}return r}function b(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"User";const t=e.split(" "),i=t.length>0&&t[0][0]?`${t[0][0]}${t.length>1&&t[1][0]?t[1][0]:""}`:"?";return{sx:{bgcolor:v(e),width:40,height:40},children:i.toUpperCase()}}const y=()=>(0,g.jsx)(n.A,{sx:{width:"100%",p:1.5},children:(0,g.jsxs)(n.A,{sx:{display:"flex",alignItems:"flex-start",mb:2,overflow:"hidden"},children:[(0,g.jsx)(s.A,{animation:"wave",variant:"circular",width:40,height:40,sx:{mr:1.5,flexShrink:0}}),(0,g.jsxs)(n.A,{sx:{flexGrow:1,minWidth:0},children:[(0,g.jsxs)(n.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:.5},children:[(0,g.jsxs)(o.A,{sx:{flexGrow:1,minWidth:0,mr:1},children:[(0,g.jsx)(s.A,{animation:"wave",height:12,width:"60%"}),(0,g.jsx)(s.A,{animation:"wave",height:10,width:"40%",sx:{mt:.5}})]}),(0,g.jsx)(s.A,{animation:"wave",height:10,width:"40px",sx:{flexShrink:0}})]}),(0,g.jsx)(s.A,{variant:"text",sx:{fontSize:"0.875rem",mb:1,width:"100%"}}),(0,g.jsx)(s.A,{variant:"text",sx:{fontSize:"0.875rem",width:"80%",mb:1}}),(0,g.jsxs)(o.A,{direction:"row",spacing:1,children:[(0,g.jsx)(s.A,{variant:"circular",width:24,height:24}),(0,g.jsx)(s.A,{variant:"circular",width:24,height:24}),(0,g.jsx)(s.A,{variant:"circular",width:24,height:24}),(0,g.jsx)(s.A,{variant:"circular",width:24,height:24})]})]})]})}),k=e=>{let{momentItem:t,onInteraction:i,onCommentClick:r}=e;const s=t.userId||"1",x="Level "+(t.userId?parseInt(s.slice(-1),10)%5+1:1);let h="Date unavailable";try{t.createdAt&&m()(t.createdAt).isValid()&&(h=m()(t.createdAt).fromNow(!0))}catch(v){console.error("[MomentItem] Error processing date:",v),h="Date error"}const j=t.userName||"Anonymous User",w=t.description||"No content provided.";return(0,g.jsx)(a.A,{in:!0,appear:!0,children:(0,g.jsxs)(n.A,{sx:{display:"flex",alignItems:"flex-start",gap:1.5,p:1.5,"&:hover":{backgroundColor:"action.hover"},borderBottom:"1px solid",borderColor:"divider",overflow:"hidden",minWidth:0,width:"100%"},children:[(0,g.jsx)(l.A,{...b(j),sx:{...b(j).sx,mt:.5,flexShrink:0}}),(0,g.jsxs)(o.A,{sx:{flexGrow:1,minWidth:0},children:[" ",(0,g.jsxs)(o.A,{direction:"row",justifyContent:"space-between",alignItems:"flex-start",spacing:1,sx:{mb:.5},children:[" ",(0,g.jsxs)(o.A,{sx:{minWidth:0},children:[" ",(0,g.jsxs)(c.A,{variant:"subtitle2",fontWeight:"bold",lineHeight:1.3,noWrap:!0,sx:{maxWidth:"100%"},children:[" ",j]}),(0,g.jsxs)(c.A,{variant:"caption",color:"text.secondary",lineHeight:1.2,children:[" ",x]})]}),(0,g.jsxs)(c.A,{variant:"caption",color:"text.secondary",sx:{flexShrink:0,whiteSpace:"nowrap",textAlign:"right"},children:[" ",h]})]}),(0,g.jsxs)(c.A,{variant:"body2",sx:{mb:1,color:"text.primary",overflowWrap:"break-word",wordWrap:"break-word",wordBreak:"break-word"},children:[" ",w]}),(0,g.jsxs)(o.A,{direction:"row",spacing:.5,alignItems:"center",sx:{flexWrap:"wrap"},children:[" ",(0,g.jsx)(d.A,{size:"small","aria-label":"translate",children:(0,g.jsx)(u.A,{fontSize:"inherit",sx:{color:"text.secondary"}})})," ",(0,g.jsx)(d.A,{size:"small","aria-label":"like",onClick:()=>i(t.id,"like"),children:(0,g.jsx)(A.A,{fontSize:"inherit",sx:{color:"text.secondary"}})})," ",(0,g.jsx)(d.A,{size:"small","aria-label":"more options",children:(0,g.jsx)(f.A,{fontSize:"inherit",sx:{color:"text.secondary"}})})," ",(0,g.jsx)(d.A,{size:"small","aria-label":"reply",onClick:()=>r(t.id),children:(0,g.jsx)(p.A,{fontSize:"inherit",sx:{color:"text.secondary"}})})," "]})]})]})})};const C=function(){const[e,t]=(0,r.useState)([]),[i,s]=(0,r.useState)(!0),[a,l]=(0,r.useState)(null);(0,r.useEffect)((()=>{(async()=>{s(!0),l(null);try{const e=await(0,w.GG)((0,w.rJ)(j.db,"users"));let i=[];for(const t of e.docs){const e=t.data();if(null!==e&&void 0!==e&&e.moments&&Array.isArray(e.moments)){const r=e.moments.map(((i,r)=>{var n,s,o;const a=null!==(n=i.createdAt)&&void 0!==n&&n.toDate?i.createdAt.toDate():null;return{...i,id:i.id||`${t.id}-moment-${r}`,createdAt:a,userName:(null===(s=e.basicInfo)||void 0===s?void 0:s.fullName)||"Anonymous User",userId:(null===(o=e.basicInfo)||void 0===o?void 0:o.studentId)||`user-${t.id.substring(0,5)}`,description:i.description||"",likeCount:i.likeCount||0,commentCount:i.commentCount||0}}));i.push(...r)}}i.sort(((e,t)=>{var i,r;return((null===(i=t.createdAt)||void 0===i?void 0:i.getTime())||0)-((null===(r=e.createdAt)||void 0===r?void 0:r.getTime())||0)}));const r=i.map((e=>({...e,userAction:"none"})));t(r)}catch(e){console.error("Error fetching moments:",e),l("Failed to load discussions. Please try again later."),t([])}finally{setTimeout((()=>s(!1)),300)}})()}),[]);const d=(0,r.useCallback)(((e,t)=>{console.log(`Interaction: ${t} on ${e}`)}),[]),h=e=>{console.log(`Reply/Comment clicked for moment: ${e}`)};return i?(0,g.jsxs)(n.A,{sx:{width:"100%"},children:[" ",Array.from(new Array(3)).map(((e,t)=>(0,g.jsx)(y,{},t)))," "]}):a?(0,g.jsx)(x.A,{severity:"error",sx:{m:2},children:a}):0===e.length?(0,g.jsx)(c.A,{variant:"body2",color:"text.secondary",align:"center",sx:{p:3},children:" No discussions found yet. "}):(0,g.jsxs)(o.A,{spacing:0,sx:{width:"100%"},children:[" ",e.map((e=>(0,g.jsx)(k,{momentItem:e,onInteraction:d,onCommentClick:h},e.id)))]})}}}]);
//# sourceMappingURL=346.b35491df.chunk.js.map